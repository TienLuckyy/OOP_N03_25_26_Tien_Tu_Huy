<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý tài khoản</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/sidebar.css">

    <style>
        body { 
            margin: 0;
            padding: 0;
            background: #0f172a;
            color: white;
            display: flex;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 2rem;
            flex: 1;
        }
        
        .card {
            background: rgba(30,41,59,0.8);
            border: 1px solid rgba(71,85,105,0.5);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(71,85,105,0.5);
        }
        
        th {
            background: rgba(15,23,42,0.8);
            color: #94a3b8;
            font-weight: 600;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .success {
            background: #10b981;
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        
        .error {
            background: #ef4444;
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #cbd5e1;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            background: rgba(15,23,42,0.8);
            border: 1px solid rgba(71,85,105,0.5);
            border-radius: 6px;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Sidebar - Copy trực tiếp từ file sidebar.html -->
    <div class="sidebar">
        <h2>Phenikaa Admin</h2>
        <nav>
            <a href="/admin/dashboard">
                <i class="fas fa-chart-line"></i><span>Dashboard</span>
            </a>
            <a href="/admin/dashboard/users" class="active">
                <i class="fas fa-users"></i><span>Quản lý tài khoản</span>
            </a>
            <a href="/admin/dashboard/sinhvien">
                <i class="fas fa-user-graduate"></i><span>Quản lý sinh viên</span>
            </a>
            <a href="/admin/dashboard/phong">
                <i class="fas fa-door-open"></i><span>Quản lý phòng</span>
            </a>
            <a href="/admin/dashboard/hopdong">
                <i class="fas fa-file-contract"></i><span>Quản lý hợp đồng</span>
            </a>
            <a href="/admin/dashboard/report">
                <i class="fas fa-chart-bar"></i><span>Thống kê & Báo cáo</span>
            </a>
        </nav>

        <div class="user-profile">
            <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                <i class="fas fa-user text-black"></i>
            </div>
            <div class="flex-1">
                <p class="text-sm font-medium">Admin</p>
                <p class="text-xs text-gray-400">admin@phenikaa.edu.vn</p>
            </div>
            <a href="/logout" class="text-gray-400 hover:text-white">
                <i class="fas fa-sign-out-alt"></i>
            </a>
        </div>
    </div>

    <div class="main-content">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">Quản lý tài khoản</h1>
            <p class="text-gray-400">Quản lý tài khoản người dùng trong hệ thống trọ sinh viên Phenikaa</p>
        </div>
        
        <!-- Hiển thị thông báo -->
        <div th:if="${param.success}" class="success">
            <i class="fas fa-check-circle mr-2"></i> Thao tác thành công!
        </div>
        <div th:if="${param.error}" class="error">
            <i class="fas fa-exclamation-circle mr-2"></i> Lỗi: <span th:text="${param.error}"></span>
        </div>

        <!-- Form sửa tài khoản -->
        <div th:if="${editUser}" class="card">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-user-edit text-yellow-400 mr-2"></i> 
                Chỉnh sửa tài khoản: <span th:text="${editUser.username}"></span>
            </h2>
            
            <form th:action="@{'/admin/dashboard/users/edit/' + ${editUser.username}}" method="post">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label>Tên đăng nhập</label>
                        <input type="text" th:value="${editUser.username}" class="form-control" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label>Mật khẩu mới (để trống nếu không đổi)</label>
                        <input type="password" name="password" class="form-control" minlength="6">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Vai trò</label>
                    <select name="role" class="form-control" required>
                        <option th:selected="${editUser.role == 'SinhVien'}" value="SinhVien">Sinh viên</option>
                        <option th:selected="${editUser.role == 'QuanLy'}" value="QuanLy">Quản lý</option>
                        <option th:selected="${editUser.role == 'Admin'}" value="Admin">Admin</option>
                    </select>
                </div>
                
                <div class="flex gap-2 mt-4">
                    <button type="submit" class="btn btn-warning">
                        <i class="fas fa-save mr-2"></i>Cập nhật
                    </button>
                    <a href="/admin/dashboard/users" class="btn" style="background: #6b7280; color: white;">
                        <i class="fas fa-times mr-2"></i>Hủy
                    </a>
                </div>
            </form>
        </div>

        <!-- Danh sách tài khoản -->
        <div class="card">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-list text-blue-400 mr-2"></i> 
                    Danh sách tài khoản
                </h2>
                <span class="text-gray-400">
                    Tổng: <span class="font-semibold text-white" th:text="${#lists.size(users)}">0</span> tài khoản
                </span>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Tên đăng nhập</th>
                        <th>Vai trò</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="user : ${users}">
                        <td th:text="${user.username}"></td>
                        <td th:text="${user.role}"></td>
                        <td>
                            <div class="flex gap-2">
                                <a th:href="@{'/admin/dashboard/users/edit?username=' + ${user.username}}" 
                                   class="btn btn-warning">
                                    <i class="fas fa-edit"></i> Sửa
                                </a>
                                
                                <form th:action="@{'/admin/dashboard/users/delete/' + ${user.username}}" 
                                      method="post" 
                                      style="display: inline;"
                                      th:if="${user.username != 'admin'}">
                                    <button type="submit" class="btn btn-danger" 
                                            onclick="return confirm('Xóa tài khoản ' + '[[${user.username}]]' + '?')">
                                        <i class="fas fa-trash"></i> Xóa
                                    </button>
                                </form>
                                
                                <span th:if="${user.username == 'admin'}" class="text-gray-400 text-sm flex items-center">
                                    Không thể xóa
                                </span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Form thêm tài khoản -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">
                <i class="fas fa-user-plus text-green-400 mr-2"></i> 
                Thêm tài khoản mới
            </h2>
            
            <form th:action="@{/admin/dashboard/users/add}" method="post">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label>Tên đăng nhập</label>
                        <input type="text" name="username" class="form-control" required minlength="3" maxlength="50">
                    </div>
                    
                    <div class="form-group">
                        <label>Mật khẩu</label>
                        <input type="password" name="password" class="form-control" required minlength="6">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Vai trò</label>
                    <select name="role" class="form-control" required>
                        <option value="">Chọn vai trò</option>
                        <option value="SinhVien">Sinh viên</option>
                        <option value="QuanLy">Quản lý</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary mt-4">
                    <i class="fas fa-plus mr-2"></i>Thêm tài khoản
                </button>
            </form>
        </div>
    </div>
</body>
</html>
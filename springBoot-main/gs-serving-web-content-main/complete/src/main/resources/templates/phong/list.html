<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">Qu·∫£n L√Ω Ph√≤ng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f5f5; font-family: Arial, sans-serif; padding: 20px; }
        h1 { margin-bottom: 20px; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .btn { border-radius: 4px; font-size: 14px; margin-right: 5px; }
        .btn-primary { background-color: #4CAF50; color: white; }
        .btn-primary:hover { background-color: #45a049; }
        .btn-warning { background-color: #ff9800; color: white; }
        .btn-warning:hover { background-color: #e68900; }
        .btn-danger { background-color: #f44336; color: white; }
        .btn-danger:hover { background-color: #da190b; }
        .btn-home { background-color: #0d6efd; color: white; }
        .btn-home:hover { background-color: #0b5ed7; }
        .btn-detail { background-color: #17a2b8; color: white; }
        .btn-detail:hover { background-color: #138496; }
        .status-badge { padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: bold; }
        .status-available { background-color: #d4edda; color: #155724; }
        .status-occupied { background-color: #f8d7da; color: #721c24; }
        .alert { padding: 12px 20px; margin-bottom: 20px; border-radius: 4px; }
        .empty-message { text-align: center; padding: 40px; color: #666; }
        table th, table td { text-align: center; padding: 12px; }
        table th { background-color: #4CAF50; color: white; }
        table tr:hover { background-color: #f5f5f5; }
        .top-actions { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center; }
        .search-bar input, .search-bar select { padding: 6px 12px; border-radius: 4px; border: 1px solid #ced4da; min-width: 200px; }
    </style>
</head>
<body>
<div class="container">

    <!-- Th√¥ng b√°o -->
    <div th:if="${param.success}" class="alert alert-success text-center">‚úÖ Th√™m ph√≤ng m·ªõi th√†nh c√¥ng!</div>
    <div th:if="${param.updated}" class="alert alert-info text-center">‚úèÔ∏è C·∫≠p nh·∫≠t ph√≤ng th√†nh c√¥ng!</div>
    <div th:if="${param.deleted}" class="alert alert-info text-center">üóëÔ∏è X√≥a ph√≤ng th√†nh c√¥ng!</div>
    <div th:if="${errorMessage}" class="alert alert-danger text-center" th:text="${errorMessage}"></div>
    
    <!-- Script t·ª± ·∫©n th√¥ng b√°o sau 3 gi√¢y -->
<script>
    setTimeout(() => {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            alert.style.transition = 'opacity 0.5s';
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 500);
        });
    }, 3000); // 3000 = 3 gi√¢y
</script>


    <!-- Header -->
    <h1 th:text="${title}">Danh S√°ch Ph√≤ng</h1>

    <!-- Thanh c√¥ng c·ª• -->
    <div class="top-actions search-bar">
        <a href="/" class="btn btn-home">üè† Trang Ch·ªß</a>
        <a href="/phong/add" class="btn btn-primary">+ Th√™m Ph√≤ng M·ªõi</a>
        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm theo s·ªë ph√≤ng ho·∫∑c t√≤a...">
        <select id="statusFilter">
            <option value="">-- L·ªçc theo tr·∫°ng th√°i --</option>
            <option value="trong">C√≤n tr·ªëng</option>
            <option value="sudung">ƒêang s·ª≠ d·ª•ng</option>
        </select>
    </div>

    <!-- B·∫£ng danh s√°ch -->
    <table class="table table-bordered table-hover" id="roomTable" th:if="${phongs != null and !phongs.isEmpty()}">
        <thead>
            <tr>
                <th>STT</th>
                <th>S·ªë Ph√≤ng</th>
                <th>T√≤a</th>
                <th>S·ª©c Ch·ª©a</th>
                <th>Ti·ªÅn Nh√†</th>
                <th>Tr·∫°ng Th√°i</th>
                <th>H√†nh ƒê·ªông</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="phong, iterStat : ${phongs}">
                <td th:text="${iterStat.index + 1}">1</td>
                <td th:text="${phong.soPhong}">101</td>
                <td th:text="${phong.toa}">A</td>
                <td th:text="${phong.soNguoiHienTai} + '/' + ${phong.soNguoiToiDa}">2/4</td>
                <td>
                    <span th:if="${phong.tienNha != null}" 
                          th:text="${#numbers.formatDecimal(phong.tienNha, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">100,000 ƒë</span>
                    <span th:unless="${phong.tienNha != null}">-</span>
                </td>
                <td>
                    <span th:if="${phong.trangThai}" class="status-badge status-occupied">ƒêang s·ª≠ d·ª•ng</span>
                    <span th:unless="${phong.trangThai}" class="status-badge status-available">C√≤n tr·ªëng</span>
                </td>
                <td>
                    <a th:href="@{'/phong/edit/' + ${phong.soPhong} + '/' + ${phong.toa}}" class="btn btn-warning btn-sm">S·ª≠a</a>
                    <a th:href="@{'/phong/delete/' + ${phong.soPhong} + '/' + ${phong.toa}}"
                       onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ph√≤ng n√†y?');"
                       class="btn btn-danger btn-sm">X√≥a</a>
                    <a th:href="@{'/phong/detail/' + ${phong.soPhong} + '/' + ${phong.toa}}" class="btn btn-detail btn-sm">Xem v√† G√°n </a>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Khi kh√¥ng c√≥ d·ªØ li·ªáu -->
    <div th:if="${phongs == null or phongs.isEmpty()}" class="empty-message">
        <p>Kh√¥ng c√≥ ph√≤ng n√†o trong danh s√°ch.</p>
        <a href="/phong/add" class="btn btn-primary">Th√™m Ph√≤ng ƒê·∫ßu Ti√™n</a>
    </div>
</div>

<!-- Script -->
<script>
setTimeout(() => {
  document.querySelectorAll('.alert-success, .alert-info').forEach(el => el.remove());
}, 3000);

const searchInput = document.getElementById('searchInput');
const statusFilter = document.getElementById('statusFilter');
const table = document.getElementById('roomTable');

if (table) {
    const rows = table.getElementsByTagName('tr');

    function filterTable() {
        const keyword = searchInput.value.toLowerCase();
        const status = statusFilter.value;
        let count = 0;

        for (let i = 1; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            if (!cells.length) continue;

            const soPhong = cells[1].innerText.toLowerCase();
            const toa = cells[2].innerText.toLowerCase();
            const trangThai = cells[5].innerText.toLowerCase();

            let matchText = soPhong.includes(keyword) || toa.includes(keyword);
            let matchStatus = !status || 
                (status === 'trong' && trangThai.includes('tr·ªëng')) ||
                (status === 'sudung' && trangThai.includes('s·ª≠ d·ª•ng'));

            const show = matchText && matchStatus;
            rows[i].style.display = show ? '' : 'none';
            if (show) {
                count++;
                cells[0].innerText = count;
            }
        }
    }

    searchInput.addEventListener('input', filterTable);
    statusFilter.addEventListener('change', filterTable);
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

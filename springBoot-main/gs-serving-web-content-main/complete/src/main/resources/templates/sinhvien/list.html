<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${title}">Danh S√°ch Sinh Vi√™n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f5f5; font-family: Arial, sans-serif; padding: 20px; }
        h1 { margin-bottom: 20px; border-bottom: 2px solid #4CAF50; padding-bottom: 10px; }
        .btn { border-radius: 4px; font-size: 14px; margin-right: 5px; }
        .btn-primary { background-color: #4CAF50; color: white; }
        .btn-primary:hover { background-color: #45a049; }
        .btn-warning { background-color: #ff9800; color: white; }
        .btn-warning:hover { background-color: #e68900; }
        .btn-danger { background-color: #f44336; color: white; }
        .btn-danger:hover { background-color: #da190b; }
        .btn-home { background-color: #0d6efd; color: white; }
        .btn-home:hover { background-color: #0b5ed7; }
        .btn-detail { background-color: #17a2b8; color: white; }
        .btn-detail:hover { background-color: #138496; }
        .status-badge { padding: 4px 12px; border-radius: 12px; font-size: 13px; font-weight: bold; }
        .status-assigned { background-color: #d4edda; color: #155724; }
        .status-unassigned { background-color: #f8d7da; color: #721c24; }
        .alert { padding: 12px 20px; margin-bottom: 20px; border-radius: 4px; }
        .empty-message { text-align: center; padding: 40px; color: #666; }
        table th, table td { text-align: center; padding: 12px; }
        table th { background-color: #4CAF50; color: white; }
        table tr:hover { background-color: #f5f5f5; }
        .top-actions { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; align-items: center; }
        .search-bar input, .search-bar select { padding: 6px 12px; border-radius: 4px; border: 1px solid #ced4da; min-width: 200px; }
    </style>
</head>
<body>
<div class="container">

    <!-- Th√¥ng b√°o -->
    <div th:if="${param.success}" class="alert alert-success text-center">‚úÖ Th√™m sinh vi√™n m·ªõi th√†nh c√¥ng!</div>
    <div th:if="${param.updated}" class="alert alert-info text-center">‚úèÔ∏è C·∫≠p nh·∫≠t sinh vi√™n th√†nh c√¥ng!</div>
    <div th:if="${param.deleted}" class="alert alert-info text-center">üóëÔ∏è X√≥a sinh vi√™n th√†nh c√¥ng!</div>
<!-- Script t·ª± ·∫©n th√¥ng b√°o sau 3 gi√¢y -->
<script>
    setTimeout(() => {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            alert.style.transition = 'opacity 0.5s';
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 500);
        });
    }, 3000); // 3000 = 3 gi√¢y
</script>
    <!-- Header -->
    <h1 th:text="${title}">Danh S√°ch Sinh Vi√™n</h1>

    <!-- Thanh c√¥ng c·ª• -->
    <div class="top-actions search-bar">
        <a href="/" class="btn btn-home">üè† Trang Ch·ªß</a>
        <a href="/sinhvien/add" class="btn btn-primary">+ Th√™m Sinh Vi√™n</a>
        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm MSSV,t√™n,ph√≤ng...">
    </div>

    <!-- B·∫£ng danh s√°ch -->
    <table class="table table-bordered table-hover" id="studentTable" th:if="${sinhviens != null and !sinhviens.isEmpty()}">
        <thead>
            <tr>
                <th>STT</th>
                <th>MSSV</th>
                <th>H·ªç T√™n</th>
                <th>Gi·ªõi T√≠nh</th>
                <th>Ng√†y Sinh</th>
                <th>L·ªõp</th>
                <th>Ng√†nh</th>
                <th>Qu√™ Qu√°n</th>
                <th>S·ªë ƒëi·ªán tho·∫°i</th>
                <th>Ph√≤ng-T√≤a</th>
                <th>H√†nh ƒê·ªông</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="sv, iterStat : ${sinhviens}">
                <td th:text="${iterStat.index + 1}">1</td>
                <td th:text="${sv.mssv}">22010052</td>
                <td th:text="${sv.hoTen}">Nguy·ªÖn VƒÉn A</td>
                <td th:text="${sv.gioiTinh}">Nam</td>
                <td th:text="${#temporals.format(sv.ngaySinh, 'dd/MM/yyyy')}">01/01/2000</td>
                <td th:text="${sv.lop}">K01</td>
                <td th:text="${sv.nganhHoc}">CNTT</td>
                <td th:text="${sv.queQuan}">H√† N·ªôi</td>
                <td th:text="${sv.soDienThoai}">0123456789</td>
                <td>
                    <span th:if="${sv.phong != null}" th:text="${sv.phong.soPhong + ' - ' + sv.phong.toa}">101 - A</span>
                    <span th:unless="${sv.phong != null}" class="status-badge status-unassigned">Ch∆∞a c√≥ ph√≤ng</span>
                </td>
                <td>
                    <a th:href="@{'/sinhvien/edit/' + ${sv.id}}" class="btn btn-warning btn-sm">S·ª≠a</a>
                    <a th:href="@{'/sinhvien/delete/' + ${sv.id}}"
                       onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a sinh vi√™n n√†y?');"
                       class="btn btn-danger btn-sm">X√≥a</a>
                    <a th:href="@{'/sinhvien/detail/' + ${sv.id}}" class="btn btn-detail btn-sm">Xem Chi Ti·∫øt</a>
                
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Khi kh√¥ng c√≥ d·ªØ li·ªáu -->
    <div th:if="${sinhviens == null or sinhviens.isEmpty()}" class="empty-message">
        <p>Kh√¥ng c√≥ sinh vi√™n n√†o trong danh s√°ch.</p>
        <a href="/sinhvien/add" class="btn btn-primary">Th√™m Sinh Vi√™n ƒê·∫ßu Ti√™n</a>
    </div>
</div>

<!-- Script -->
<script>
// H√†m ·∫©n th√¥ng b√°o sau 3 gi√¢y
setTimeout(() => {
  document.querySelectorAll('.alert-success, .alert-info').forEach(el => el.remove());
}, 3000);

// L·∫•y c√°c ph·∫ßn t·ª≠ DOM
const searchInput = document.getElementById('searchInput');
const table = document.getElementById('studentTable');

// L·ªñI 1: X√≥a c√°c bi·∫øn tham chi·∫øu ƒë·∫øn 'statusFilter' v√† 'roomFilter' kh√¥ng t·ªìn t·∫°i
// const statusFilter = document.getElementById('statusFilter');
// const roomFilter = document.getElementById('roomFilter');

if (table) {
    // L·∫•y t·∫•t c·∫£ c√°c h√†ng <tr> trong <tbody>
    const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');

    function filterTable() {
        const keyword = searchInput.value.toLowerCase();
        let count = 0;

        // L·∫∑p qua t·∫•t c·∫£ c√°c h√†ng
        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            if (!cells.length) continue;

            // L·∫•y n·ªôi dung text t·ª´ c√°c c·ªôt b·∫°n mu·ªën t√¨m ki·∫øm
            const mssv = cells[1].innerText.toLowerCase();
            const name = cells[2].innerText.toLowerCase();
            
            // L·ªñI 2: C·ªôt "Ph√≤ng-T√≤a" l√† c·ªôt th·ª© 10 (index 9), kh√¥ng ph·∫£i 6
            const phong = cells[9].innerText.toLowerCase();

            // L·ªñI 3: C·∫≠p nh·∫≠t l·∫°i logic t√¨m ki·∫øm
            // Ch·ªâ t√¨m ki·∫øm d·ª±a tr√™n t·ª´ kh√≥a (keyword)
            const matchText = mssv.includes(keyword) || 
                              name.includes(keyword) || 
                              phong.includes(keyword);

            // X√≥a t·∫•t c·∫£ logic li√™n quan ƒë·∫øn 'status' v√† 'room' kh√¥ng t·ªìn t·∫°i
            const show = matchText;

            rows[i].style.display = show ? '' : 'none';
            
            // ƒê√°nh l·∫°i s·ªë th·ª© t·ª± (STT) cho c√°c h√†ng ƒë∆∞·ª£c hi·ªÉn th·ªã
            if (show) {
                count++;
                cells[0].innerText = count;
            }
        }
    }

    // G√°n s·ª± ki·ªán 'input' cho thanh t√¨m ki·∫øm
    searchInput.addEventListener('input', filterTable);
    
    // L·ªñI 4: X√≥a c√°c event listener cho c√°c ph·∫ßn t·ª≠ kh√¥ng t·ªìn t·∫°i
    // statusFilter.addEventListener('change', filterTable);
    // roomFilter.addEventListener('input', filterTable);
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
